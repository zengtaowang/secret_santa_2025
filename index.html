<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>麻辣格林伍德Secret Santa抽签</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        .result-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
        }
        .result-name {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }
        .btn-draw {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 10px;
        }
        .btn-draw:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .progress-table {
            background: white;
            border-radius: 10px;
            padding: 20px;
        }
        h1, h2, h3 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .admin-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">麻辣格林伍德Secret Santa抽签</h1>
        <p class="text-center text-white mb-4">12/07/2025火锅局</p>

        <div class="card">
            <div class="card-body">
                <div class="alert alert-warning" role="alert">
                    <strong>⚠️ 重要提醒：</strong>
                    <ul class="mb-0 mt-2">
                        <li>每个人只能抽取一次，选择后立即锁定</li>
                        <li>不要让别人看到你的屏幕</li>
                        <li>不要告诉任何人你抽到了谁</li>
                        <li>Budget limit: $30</li>
                    </ul>
                </div>

                <h3>抽取你的对象</h3>
                
                <div class="mb-3">
                    <label for="nameSelect" class="form-label">选择你的名字：</label>
                    <select class="form-select" id="nameSelect">
                        <option value="">请选择...</option>
                        <option value="蛋糕女皇Nicole石">蛋糕女皇Nichole石</option>
                        <option value="乒乓教主Liang">乒乓教主Liang</option>
                        <option value="闷声干大事的阿刁">闷声干大事的阿刁</option>
                        <option value="留守儿童狗蛋">留守儿童狗蛋</option>
                        <option value="大艺术家Lulu">大艺术家Lulu</option>
                        <option value="厨子小王">厨子小王</option>
                    </select>
                </div>

                <button class="btn btn-danger btn-draw w-100" onclick="drawName()">查看我的对象</button>

                <div id="result"></div>
            </div>
        </div>

        <div class="card admin-panel">
            <div class="card-body">
                <h5>管理员面板（可以看到所有抽签结果，不要点，用于重置！）</h5>
                <div class="mb-3">
                    <label for="adminPass" class="form-label">管理员密码：</label>
                    <input type="password" class="form-control" id="adminPass">
                </div>
                <button class="btn btn-secondary btn-sm" onclick="adminLogin()">管理员登录</button>
                <div id="adminPanel" style="display:none; margin-top:20px;">
                    <div class="alert alert-info">
                        <strong>管理员提示：</strong> 如果你也是参与者，不要点击"显示配对"按钮！
                    </div>
                    
                    <button class="btn btn-warning btn-sm" onclick="resetProgress()">重置抽签进度</button>
                    <button class="btn btn-danger btn-sm ms-2" onclick="toggleAssignments()">显示/隐藏配对（慎点！）</button>
                    
                    <h5 class="mt-3">抽签进度：</h5>
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>参与者</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody id="progressBody">
                        </tbody>
                    </table>
                    
                    <div id="assignmentsSection" style="display:none;">
                        <h5 class="mt-3 text-danger">⚠️ 当前配对（别看！）：</h5>
                        <table class="table table-sm" id="assignmentTable">
                            <thead>
                                <tr>
                                    <th>送礼者</th>
                                    <th>→</th>
                                    <th>收礼者</th>
                                </tr>
                            </thead>
                            <tbody id="assignmentBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center text-white mt-4">
            <p>注意事项：</p>
            <ul class="text-start" style="max-width: 500px; margin: 0 auto;">
                <li>私下抽取你的对象，不要让别人看到你的屏幕</li>
                <li>保守秘密！不要告诉任何人你抽到了谁</li>
                <li>玩得开心！</li>
            </ul>
        </div>
    </div>

    <script>
        const PARTICIPANTS = [
            "蛋糕女皇Nicole石",
            "乒乓教主Liang",
            "闷声干大事的阿刁",
            "留守儿童狗蛋",
            "大艺术家Lulu",
            "厨子小王"
        ];
        
        const ADMIN_PASSWORD = "admin123";

        // FIXED ASSIGNMENTS - Everyone sees the same pairings
        // DO NOT CHANGE UNLESS YOU WANT TO REGENERATE
        const FIXED_ASSIGNMENTS = {
            "蛋糕女皇Nicole石": "闷声干大事的阿刁",
            "乒乓教主Liang": "留守儿童狗蛋",
            "闷声干大事的阿刁": "厨子小王",
            "留守儿童狗蛋": "大艺术家Lulu",
            "大艺术家Lulu": "蛋糕女皇Nicole石",
            "厨子小王": "乒乓教主Liang"
        };

        // Get assignments - always returns the fixed assignments
        function getAssignments() {
            return FIXED_ASSIGNMENTS;
        }

        function generateAssignments() {
            let givers = [...PARTICIPANTS];
            let receivers = [...PARTICIPANTS];
            let valid = false;
            let attempts = 0;

            while (!valid && attempts < 1000) {
                attempts++;
                receivers = shuffleArray([...PARTICIPANTS]);
                valid = !givers.some((giver, i) => giver === receivers[i]);
            }

            const assignments = {};
            givers.forEach((giver, i) => {
                assignments[giver] = receivers[i];
            });

            return assignments;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getDrawnNames() {
            let drawn = localStorage.getItem('secretSantaDrawn');
            return drawn ? JSON.parse(drawn) : [];
        }

        function setDrawnNames(drawn) {
            localStorage.setItem('secretSantaDrawn', JSON.stringify(drawn));
        }

        function drawName() {
            const select = document.getElementById('nameSelect');
            const drawer = select.value;
            const resultDiv = document.getElementById('result');

            if (!drawer) {
                alert('请选择你的姓名！');
                return;
            }

            const drawn = getDrawnNames();
            if (drawn.includes(drawer)) {
                alert('你已经抽过了！');
                return;
            }

            const assignments = getAssignments();
            const receiver = assignments[drawer];

            drawn.push(drawer);
            setDrawnNames(drawn);
            
            // Mark this session as having drawn
            sessionStorage.setItem('hasDrawnName', 'true');

            // Disable the form to prevent drawing again
            select.disabled = true;
            document.querySelector('.btn-draw').disabled = true;

            resultDiv.innerHTML = `
                <div class="result-box">
                    <h3>${drawer}</h3>
                    <h2>你是以下这位的神秘圣诞老人：</h2>
                    <div class="result-name">${receiver}</div>
                    <hr style="border-color: white;">
                    <p style="font-size: 0.9em;">记住：保守秘密！不要告诉任何人你抽到了谁。</p>
                    <p style="font-size: 0.8em; margin-top: 10px;">⚠️ 此页面现已锁定。关闭页面后无法再次查看。</p>
                </div>
            `;
        }

        function adminLogin() {
            const password = document.getElementById('adminPass').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('adminPanel').style.display = 'block';
                updateProgressTable();
                alert('管理员登录成功！\n\n⚠️ 如果你也是参与者，不要点击"显示配对"按钮！');
            } else {
                alert('密码错误！');
            }
        }

        function toggleAssignments() {
            const section = document.getElementById('assignmentsSection');
            if (section.style.display === 'none') {
                if (confirm('⚠️ 警告：你确定要查看配对吗？\n\n如果你也是参与者，这将破坏你自己的惊喜！')) {
                    section.style.display = 'block';
                    showAssignments();
                }
            } else {
                section.style.display = 'none';
            }
        }

        function updateProgressTable() {
            const drawn = getDrawnNames();
            const tbody = document.getElementById('progressBody');
            tbody.innerHTML = '';

            PARTICIPANTS.forEach(participant => {
                const row = tbody.insertRow();
                const cell1 = row.insertCell(0);
                const cell2 = row.insertCell(1);
                cell1.textContent = participant;
                cell2.textContent = drawn.includes(participant) ? '✓ 已抽取' : '⏳ 待抽取';
            });
        }

        function showAssignments() {
            const assignments = getAssignments();
            const tbody = document.getElementById('assignmentBody');
            tbody.innerHTML = '';

            Object.entries(assignments).forEach(([giver, receiver]) => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = giver;
                row.insertCell(1).textContent = '→';
                row.insertCell(2).textContent = receiver;
            });
        }



        function resetProgress() {
            if (confirm('确定要重置抽签进度吗？')) {
                localStorage.removeItem('secretSantaDrawn');
                updateProgressTable();
                alert('抽签进度已重置！');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if current user already drew (based on stored session)
            const hasDrawn = sessionStorage.getItem('hasDrawnName');
            if (hasDrawn) {
                document.getElementById('nameSelect').disabled = true;
                document.querySelector('.btn-draw').disabled = true;
                document.getElementById('result').innerHTML = `
                    <div class="alert alert-info mt-3">
                        你已经在本次会话中抽过签了。如需重新查看，请联系管理员。
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
